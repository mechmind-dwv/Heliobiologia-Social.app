<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåû HelioBio-Social Dashboard v1.0</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <style>
        :root {
            --cosmic-purple: #6a11cb;
            --solar-orange: #ff8c00;
            --social-blue: #2575fc;
            --resonance-green: #00b894;
            --alert-red: #ff6b6b;
            --background-dark: #0f0c29;
            --card-bg: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--background-dark), #24243e, #302b63);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--solar-orange), var(--social-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.8;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .metric-card h3 {
            font-size: 1.1em;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        
        .metric-value {
            font-size: 2.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .metric-trend {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-title {
            font-size: 1.3em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart {
            height: 400px;
        }
        
        .mini-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .mini-chart {
            height: 180px;
        }
        
        .status-alert {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border-left: 5px solid var(--alert-red);
        }
        
        .resonance-high { color: var(--alert-red); }
        .resonance-medium { color: var(--solar-orange); }
        .resonance-low { color: var(--resonance-green); }
        
        .last-update {
            text-align: center;
            opacity: 0.7;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <h1>üåû HelioBio-Social Dashboard</h1>
            <p>Monitoreo en tiempo real de la resonancia entre actividad solar y comportamiento social</p>
            <div class="last-update" id="lastUpdate">
                √öltima actualizaci√≥n: <span class="pulse">cargando...</span>
            </div>
        </div>
        
        <!-- Alertas de Estado -->
        <div class="status-alert" id="statusAlert" style="display: none;">
            <h3>üö® Alerta del Sistema</h3>
            <p id="alertMessage"></p>
        </div>
        
        <!-- Grid de M√©tricas Principales -->
        <div class="metrics-grid">
            <div class="metric-card">
                <h3>üåû Actividad Solar</h3>
                <div class="metric-value" id="solarValue">--</div>
                <div class="metric-trend" id="solarTrend">Manchas solares</div>
            </div>
            
            <div class="metric-card">
                <h3>üë• Estado Social</h3>
                <div class="metric-value" id="socialValue">--</div>
                <div class="metric-trend" id="socialTrend">Engagement colectivo</div>
            </div>
            
            <div class="metric-card">
                <h3>üîó Resonancia</h3>
                <div class="metric-value" id="resonanceValue">--</div>
                <div class="metric-trend" id="resonanceTrend">Conexi√≥n solar-social</div>
            </div>
            
            <div class="metric-card">
                <h3>‚ö†Ô∏è Alerta Crispaci√≥n</h3>
                <div class="metric-value" id="crispationValue">--</div>
                <div class="metric-trend" id="crispationTrend">Nivel de riesgo</div>
            </div>
        </div>
        
        <!-- Grid de Gr√°ficos Principales -->
        <div class="charts-grid">
            <!-- Gr√°fico Principal de Resonancia -->
            <div class="chart-container">
                <div class="chart-title">üìà Resonancia Solar-Social en Tiempo Real</div>
                <div id="resonanceChart" class="chart"></div>
            </div>
            
            <!-- Gr√°ficos Secundarios -->
            <div class="mini-charts">
                <div class="chart-container">
                    <div class="chart-title">üåû Actividad Solar</div>
                    <div id="solarChart" class="mini-chart"></div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">üë• M√©tricas Sociales</div>
                    <div id="socialChart" class="mini-chart"></div>
                </div>
            </div>
        </div>
        
        <!-- Gr√°ficos de Tendencias -->
        <div class="charts-grid">
            <div class="chart-container">
                <div class="chart-title">üïí Tendencia Temporal - Actividad Solar</div>
                <div id="solarTrendChart" class="chart"></div>
            </div>
            <div class="chart-container">
                <div class="chart-title">üïí Tendencia Temporal - Comportamiento Social</div>
                <div id="socialTrendChart" class="chart"></div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales para almacenar datos
        let historicalData = [];
        let updateInterval;
        
        // Inicializar dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            startAutoUpdate();
        });
        
        async function initializeDashboard() {
            await updateAllData();
            updateInterval = setInterval(updateAllData, 10000); // Actualizar cada 10 segundos
        }
        
        async function updateAllData() {
            try {
                const [solarRes, socialRes, correlationRes, historicalRes] = await Promise.all([
                    fetch('/api/solar/current'),
                    fetch('/api/social/analysis'),
                    fetch('/api/correlation/realtime'),
                    fetch('/api/historical/data?hours=6')
                ]);
                
                const solarData = await solarRes.json();
                const socialData = await socialRes.json();
                const correlationData = await correlationRes.json();
                const historicalDataResponse = await historicalRes.json();
                
                historicalData = historicalDataResponse.data || [];
                
                updateMetrics(solarData, socialData, correlationData);
                updateCharts(solarData, socialData, correlationData);
                updateAlert(correlationData);
                updateLastUpdate();
                
            } catch (error) {
                console.error('Error actualizando datos:', error);
                showError('Error de conexi√≥n con el servidor');
            }
        }
        
        function updateMetrics(solar, social, correlation) {
            // Actualizar m√©trica solar
            const sunspots = solar.solar_activity.sunspot_number;
            document.getElementById('solarValue').innerHTML = `${sunspots}`;
            document.getElementById('solarTrend').innerHTML = 
                `Nivel ${solar.solar_activity.flare_activity}/5 ‚Ä¢ ${solar.solar_activity.geomagnetic_storm} geomag`;
            
            // Actualizar m√©trica social
            const engagement = social.social_analysis.engagement_intensity;
            document.getElementById('socialValue').innerHTML = `${engagement.toFixed(1)}%`;
            document.getElementById('socialTrend').innerHTML = 
                `${social.collective_mood.split(' - ')[0]}`;
            
            // Actualizar m√©trica de resonancia
            const resonance = correlation.correlation_analysis.solar_social_resonance * 100;
            const resonanceClass = resonance > 70 ? 'resonance-high' : resonance > 40 ? 'resonance-medium' : 'resonance-low';
            document.getElementById('resonanceValue').innerHTML = 
                `<span class="${resonanceClass}">${resonance.toFixed(1)}%</span>`;
            document.getElementById('resonanceTrend').innerHTML = 
                correlation.correlation_analysis.interpretation;
            
            // Actualizar m√©trica de crispaci√≥n
            const alertLevel = correlation.crispation_alert.level;
            const alertColor = alertLevel === 'HIGH' ? 'resonance-high' : alertLevel === 'MODERATE' ? 'resonance-medium' : 'resonance-low';
            document.getElementById('crispationValue').innerHTML = 
                `<span class="${alertColor}">${alertLevel}</span>`;
            document.getElementById('crispationTrend').innerHTML = 
                correlation.crispation_alert.message;
        }
        
        function updateCharts(solar, social, correlation) {
            updateResonanceChart(correlation);
            updateSolarChart(solar);
            updateSocialChart(social);
            updateTrendCharts();
        }
        
        function updateResonanceChart(correlation) {
            const resonance = correlation.correlation_analysis.solar_social_resonance * 100;
            
            const data = [{
                type: "indicator",
                mode: "gauge+number+delta",
                value: resonance,
                title: { text: "Resonancia Solar-Social" },
                delta: { reference: 40 },
                gauge: {
                    axis: { range: [null, 100] },
                    bar: { color: getResonanceColor(resonance) },
                    steps: [
                        { range: [0, 30], color: "lightgray" },
                        { range: [30, 70], color: "yellow" },
                        { range: [70, 100], color: "orange" }
                    ],
                    threshold: {
                        line: { color: "red", width: 4 },
                        thickness: 0.75,
                        value: 80
                    }
                }
            }];
            
            const layout = {
                margin: { t: 50, b: 10, l: 50, r: 50 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' }
            };
            
            Plotly.react('resonanceChart', data, layout);
        }
        
        function updateSolarChart(solar) {
            const data = [{
                type: 'bar',
                x: ['Manchas', 'Fulguraciones', 'Geomagn√©tico'],
                y: [
                    solar.solar_activity.sunspot_number / 2,
                    solar.solar_activity.flare_activity * 20,
                    solar.solar_activity.geomagnetic_storm * 25
                ],
                marker: {
                    color: ['#FFA726', '#FF7043', '#42A5F5'],
                    line: { color: 'white', width: 1 }
                }
            }];
            
            const layout = {
                margin: { t: 30, b: 30, l: 40, r: 20 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' },
                showlegend: false,
                xaxis: { tickfont: { size: 10 } },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)' }
            };
            
            Plotly.react('solarChart', data, layout);
        }
        
        function updateSocialChart(social) {
            const data = [{
                type: 'pie',
                labels: ['Engagement', 'Sentimiento', 'Conflicto'],
                values: [
                    social.social_analysis.engagement_intensity,
                    Math.abs(social.social_analysis.sentiment_polarity) * 100,
                    social.social_analysis.conflict_metric * 100
                ],
                marker: {
                    colors: ['#4CAF50', '#2196F3', '#F44336'],
                    line: { color: 'white', width: 1 }
                },
                textinfo: 'label+percent',
                insidetextorientation: 'radial'
            }];
            
            const layout = {
                margin: { t: 30, b: 30, l: 30, r: 30 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' },
                showlegend: false
            };
            
            Plotly.react('socialChart', data, layout);
        }
        
        function updateTrendCharts() {
            if (historicalData.length === 0) return;
            
            // Gr√°fico de tendencia solar
            const solarTimes = historicalData.map(d => 
                moment(d.timestamp).format('HH:mm')
            );
            const sunspotData = historicalData.map(d => d.solar.sunspot_number);
            const flareData = historicalData.map(d => d.solar.flare_activity * 20);
            
            const solarTrendData = [
                {
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Manchas Solares',
                    x: solarTimes,
                    y: sunspotData,
                    line: { color: '#FFA726', width: 3 }
                },
                {
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Actividad Fulguraciones',
                    x: solarTimes,
                    y: flareData,
                    line: { color: '#FF7043', width: 2 }
                }
            ];
            
            const solarTrendLayout = {
                margin: { t: 40, b: 50, l: 50, r: 30 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                legend: { orientation: 'h', y: -0.2 }
            };
            
            Plotly.react('solarTrendChart', solarTrendData, solarTrendLayout);
            
            // Gr√°fico de tendencia social
            const engagementData = historicalData.map(d => d.social.engagement_intensity);
            const conflictData = historicalData.map(d => d.social.conflict_metric * 100);
            
            const socialTrendData = [
                {
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Engagement',
                    x: solarTimes,
                    y: engagementData,
                    line: { color: '#4CAF50', width: 3 }
                },
                {
                    type: 'scatter', 
                    mode: 'lines',
                    name: 'Nivel Conflicto',
                    x: solarTimes,
                    y: conflictData,
                    line: { color: '#F44336', width: 2 }
                }
            ];
            
            const socialTrendLayout = {
                margin: { t: 40, b: 50, l: 50, r: 30 },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: 'white' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                legend: { orientation: 'h', y: -0.2 }
            };
            
            Plotly.react('socialTrendChart', socialTrendData, socialTrendLayout);
        }
        
        function updateAlert(correlation) {
            const alertElement = document.getElementById('statusAlert');
            const alertMessage = document.getElementById('alertMessage');
            const alertLevel = correlation.crispation_alert.level;
            
            if (alertLevel === 'HIGH') {
                alertElement.style.display = 'block';
                alertElement.style.borderLeftColor = 'var(--alert-red)';
                alertMessage.innerHTML = `
                    <strong>ALTA RESONANCIA DETECTADA:</strong> ${correlation.crispation_alert.message}<br>
                    <small>Recomendaci√≥n: Monitorizar tendencias de conflicto en redes sociales</small>
                `;
            } else if (alertLevel === 'MODERATE') {
                alertElement.style.display = 'block';
                alertElement.style.borderLeftColor = 'var(--solar-orange)';
                alertMessage.innerHTML = `
                    <strong>RESONANCIA MODERADA:</strong> ${correlation.crispation_alert.message}<br>
                    <small>Condiciones dentro de par√°metros normales</small>
                `;
            } else {
                alertElement.style.display = 'none';
            }
        }
        
        function updateLastUpdate() {
            const now = new Date();
            document.getElementById('lastUpdate').innerHTML = 
                `√öltima actualizaci√≥n: ${now.toLocaleTimeString()}`;
        }
        
        function getResonanceColor(resonance) {
            if (resonance > 70) return '#ff6b6b';
            if (resonance > 40) return '#ffd93d';
            return '#6bcf7f';
        }
        
        function showError(message) {
            const alertElement = document.getElementById('statusAlert');
            const alertMessage = document.getElementById('alertMessage');
            
            alertElement.style.display = 'block';
            alertElement.style.borderLeftColor = 'var(--alert-red)';
            alertMessage.innerHTML = `<strong>ERROR:</strong> ${message}`;
        }
        
        function startAutoUpdate() {
            setInterval(updateAllData, 10000); // Actualizar cada 10 segundos
        }
    </script>
</body>
</html>
